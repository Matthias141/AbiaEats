# AbiaEats - Add error logging to signup route

$ScriptDir = Split-Path -Parent $MyInvocation.MyCommand.Path
Set-Location $ScriptDir
Write-Host "Applying fix..." -ForegroundColor Cyan

[System.IO.File]::WriteAllBytes((Join-Path $ScriptDir "src\app\api\auth\signup\route.ts"), [System.Convert]::FromBase64String("LyoqCiAqIFJhdGUtbGltaXRlZCBzaWdudXAgZW5kcG9pbnQuCiAqCiAqIFdyYXBzIFN1cGFiYXNlIGF1dGggc28gd2UgY2FuIGVuZm9yY2UgcmF0ZSBsaW1pdGluZyBiZWZvcmUgYWNjb3VudCBjcmVhdGlvbi4KICogUmF0ZSBsaW1pdDogMyBzaWdudXBzIHBlciBob3VyIHBlciBJUCAoc2lnbnVwUmF0ZUxpbWl0IGluIHJhdGUtbGltaXQudHMpLgogKiBGYWlscyBvcGVuIGlmIFVwc3Rhc2ggaXMgbm90IGNvbmZpZ3VyZWQuCiAqLwoKaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInOwppbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAL2xpYi9zdXBhYmFzZS9zZXJ2ZXInOwppbXBvcnQgeyBzaWdudXBTY2hlbWEgfSBmcm9tICdAL2xpYi92YWxpZGF0aW9ucyc7CmltcG9ydCB7IHNpZ251cFJhdGVMaW1pdCwgYXBwbHlSYXRlTGltaXQgfSBmcm9tICdAL2xpYi9yYXRlLWxpbWl0JzsKCmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IFJlcXVlc3QpIHsKICAvLyDilIDilIAgUmF0ZSBsaW1pdGluZyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKICB0cnkgewogICAgY29uc3QgYmxvY2tlZCA9IGF3YWl0IGFwcGx5UmF0ZUxpbWl0KHNpZ251cFJhdGVMaW1pdCwgcmVxdWVzdCk7CiAgICBpZiAoYmxvY2tlZCkgcmV0dXJuIGJsb2NrZWQ7CiAgfSBjYXRjaCB7CiAgICAvLyBVcHN0YXNoIG5vdCBjb25maWd1cmVkIOKAlCBmYWlsIG9wZW4KICB9CgogIC8vIOKUgOKUgCBQYXJzZSArIHZhbGlkYXRlIGJvZHkg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACiAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpLmNhdGNoKCgpID0+IG51bGwpOwogIGNvbnN0IHBhcnNlZCA9IHNpZ251cFNjaGVtYS5zYWZlUGFyc2UoYm9keSk7CiAgaWYgKCFwYXJzZWQuc3VjY2VzcykgewogICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKAogICAgICB7IGVycm9yOiBwYXJzZWQuZXJyb3IuaXNzdWVzWzBdLm1lc3NhZ2UgfSwKICAgICAgeyBzdGF0dXM6IDQwMCB9CiAgICApOwogIH0KCiAgLy8g4pSA4pSAIENyZWF0ZSBhY2NvdW50IOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAogIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7CiAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5zaWduVXAoewogICAgZW1haWw6IHBhcnNlZC5kYXRhLmVtYWlsLAogICAgcGFzc3dvcmQ6IHBhcnNlZC5kYXRhLnBhc3N3b3JkLAogICAgb3B0aW9uczogewogICAgICBkYXRhOiB7CiAgICAgICAgZnVsbF9uYW1lOiBwYXJzZWQuZGF0YS5mdWxsX25hbWUsCiAgICAgICAgcGhvbmU6IHBhcnNlZC5kYXRhLnBob25lLAogICAgICAgIHJvbGU6ICdjdXN0b21lcicsIC8vIGhhcmQtY29kZWQg4oCUIG5ldmVyIHRydXN0IGEgY2xpZW50LXByb3ZpZGVkIHJvbGUKICAgICAgfSwKICAgIH0sCiAgfSk7CgogIGlmIChlcnJvcikgewogICAgLy8gTG9nIHJlYWwgZXJyb3Igc2VydmVyLXNpZGUgZm9yIGRlYnVnZ2luZwogICAgY29uc29sZS5lcnJvcignW3NpZ251cF0gU3VwYWJhc2UgZXJyb3I6JywgZXJyb3IubWVzc2FnZSwgZXJyb3Iuc3RhdHVzLCBlcnJvci5jb2RlKTsKICAgIC8vIEdlbmVyaWMgbWVzc2FnZSB0byBjbGllbnQg4oCUIG5ldmVyIGV4cG9zZSBpbnRlcm5hbCBkZXRhaWxzCiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oCiAgICAgIHsgZXJyb3I6ICdTb21ldGhpbmcgd2VudCB3cm9uZy4gUGxlYXNlIHRyeSBhZ2Fpbi4nIH0sCiAgICAgIHsgc3RhdHVzOiA1MDAgfQogICAgKTsKICB9CgogIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IG9rOiB0cnVlIH0pOwp9Cg=="))
Write-Host "  [1/1] src/app/api/auth/signup/route.ts" -ForegroundColor Green

git add -A
git commit -m "debug: log real Supabase signup error to server logs"
git push
Write-Host "Done. Try signing up again, then check Vercel logs." -ForegroundColor Green